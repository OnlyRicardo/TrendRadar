name: Test Email and Run TrendRadar

on:
  workflow_dispatch:

jobs:
  test-email:
    runs-on: ubuntu-latest
    env:
      EMAIL_FROM: ${{ secrets.EMAIL_FROM }}
      EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
      EMAIL_TO: ${{ secrets.EMAIL_TO }}
      EMAIL_SMTP_SERVER: ${{ secrets.EMAIL_SMTP_SERVER }}
      EMAIL_SMTP_PORT: ${{ secrets.EMAIL_SMTP_PORT }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Check env presence (do NOT print secret values)
        run: |
          python - <<'PY'
import os
print("EMAIL_FROM present:", bool(os.getenv("EMAIL_FROM")))
print("EMAIL_PASSWORD present:", bool(os.getenv("EMAIL_PASSWORD")))
print("EMAIL_TO present:", bool(os.getenv("EMAIL_TO")))
print("EMAIL_SMTP_SERVER present:", bool(os.getenv("EMAIL_SMTP_SERVER")))
print("EMAIL_SMTP_PORT present:", bool(os.getenv("EMAIL_SMTP_PORT")))
PY

      - name: Run email test script
        run: |
          python scripts/email_test.py

      - name: (Optional) Run TrendRadar main.py
        run: |
          python main.py
